"use client";import{useFocusRing as re}from"@react-aria/focus";import{useHover as oe}from"@react-aria/interactions";import b,{Fragment as W,createContext as ae,createRef as X,useContext as ie,useEffect as se,useMemo as U,useReducer as le,useRef as $}from"react";import{useActivePress as ue}from'../../hooks/use-active-press.js';import{useDidElementMove as pe}from'../../hooks/use-did-element-move.js';import{useDisposables as q}from'../../hooks/use-disposables.js';import{useElementSize as de}from'../../hooks/use-element-size.js';import{useEvent as I}from'../../hooks/use-event.js';import{useId as H}from'../../hooks/use-id.js';import{useIsoMorphicEffect as k}from'../../hooks/use-iso-morphic-effect.js';import{useOutsideClick as me}from'../../hooks/use-outside-click.js';import{useOwnerDocument as ce}from'../../hooks/use-owner.js';import{useResolveButtonType as fe}from'../../hooks/use-resolve-button-type.js';import{useSyncRefs as N}from'../../hooks/use-sync-refs.js';import{useTextValue as Te}from'../../hooks/use-text-value.js';import{useTrackedPointer as ye}from'../../hooks/use-tracked-pointer.js';import{useTreeWalker as ge}from'../../hooks/use-tree-walker.js';import{FloatingProvider as Ie,useFloatingPanel as Me,useFloatingPanelProps as Pe,useFloatingReference as Ae,useFloatingReferenceProps as Se}from'../../internal/floating.js';import{Modal as be,ModalFeatures as Ee}from'../../internal/modal.js';import{OpenClosedProvider as Re,State as w,useOpenClosed as ve}from'../../internal/open-closed.js';import{isDisabledReactIssue7711 as xe}from'../../utils/bugs.js';import{Focus as y,calculateActiveIndex as K}from'../../utils/calculate-active-index.js';import{disposables as j}from'../../utils/disposables.js';import{Focus as z,FocusableMode as _e,focusFrom as De,isFocusableElement as Fe,restoreFocusIfNecessary as Y,sortByDomNode as he}from'../../utils/focus-management.js';import{match as Z}from'../../utils/match.js';import{RenderFeatures as ee,forwardRefWithAs as E,mergeProps as te,render as R}from'../../utils/render.js';import{useDescriptions as Ce}from'../description/description.js';import{Keys as T}from'../keyboard.js';import{useLabelContext as Oe,useLabels as ne}from'../label/label.js';import{Portal as Le}from'../portal/portal.js';var Ge=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))(Ge||{}),Ue=(n=>(n[n.Pointer=0]="Pointer",n[n.Other=1]="Other",n))(Ue||{}),He=(t=>(t[t.OpenMenu=0]="OpenMenu",t[t.CloseMenu=1]="CloseMenu",t[t.GoToItem=2]="GoToItem",t[t.Search=3]="Search",t[t.ClearSearch=4]="ClearSearch",t[t.RegisterItem=5]="RegisterItem",t[t.UnregisterItem=6]="UnregisterItem",t))(He||{});function Q(e,r=n=>n){let n=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,a=he(r(e.items.slice()),s=>s.dataRef.current.domRef.current),i=n?a.indexOf(n):null;return i===-1&&(i=null),{items:a,activeItemIndex:i}}let ke={[1](e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},[0](e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},[2]:(e,r)=>{var s,l,t,u,m;if(e.menuState===1)return e;let n={...e,searchQuery:"",activationTrigger:(s=r.trigger)!=null?s:1};if(r.focus===y.Nothing)return{...n,activeItemIndex:null};if(r.focus===y.Specific)return{...n,activeItemIndex:e.items.findIndex(d=>d.id===r.id)};if(r.focus===y.Previous){let d=e.activeItemIndex;if(d!==null){let M=e.items[d].dataRef.current.domRef,f=K(r,{resolveItems:()=>e.items,resolveActiveIndex:()=>e.activeItemIndex,resolveId:p=>p.id,resolveDisabled:p=>p.dataRef.current.disabled});if(f!==null){let p=e.items[f].dataRef.current.domRef;if(((l=M.current)==null?void 0:l.previousElementSibling)===p.current||((t=p.current)==null?void 0:t.previousElementSibling)===null)return{...n,activeItemIndex:f}}}}else if(r.focus===y.Next){let d=e.activeItemIndex;if(d!==null){let M=e.items[d].dataRef.current.domRef,f=K(r,{resolveItems:()=>e.items,resolveActiveIndex:()=>e.activeItemIndex,resolveId:p=>p.id,resolveDisabled:p=>p.dataRef.current.disabled});if(f!==null){let p=e.items[f].dataRef.current.domRef;if(((u=M.current)==null?void 0:u.nextElementSibling)===p.current||((m=p.current)==null?void 0:m.nextElementSibling)===null)return{...n,activeItemIndex:f}}}}let a=Q(e),i=K(r,{resolveItems:()=>a.items,resolveActiveIndex:()=>a.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});return{...n,...a,activeItemIndex:i}},[3]:(e,r)=>{let a=e.searchQuery!==""?0:1,i=e.searchQuery+r.value.toLowerCase(),l=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+a).concat(e.items.slice(0,e.activeItemIndex+a)):e.items).find(u=>{var m;return((m=u.dataRef.current.textValue)==null?void 0:m.startsWith(i))&&!u.dataRef.current.disabled}),t=l?e.items.indexOf(l):-1;return t===-1||t===e.activeItemIndex?{...e,searchQuery:i}:{...e,searchQuery:i,activeItemIndex:t,activationTrigger:1}},[4](e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},[5]:(e,r)=>{let n=Q(e,a=>[...a,{id:r.id,dataRef:r.dataRef}]);return{...e,...n}},[6]:(e,r)=>{let n=Q(e,a=>{let i=a.findIndex(s=>s.id===r.id);return i!==-1&&a.splice(i,1),a});return{...e,...n,activationTrigger:1}}},J=ae(null);J.displayName="MenuContext";function B(e){let r=ie(J);if(r===null){let n=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,B),n}return r}function Ne(e,r){return Z(r.type,ke,e,r)}let we=W;function Be(e,r){let{__demoMode:n=!1,...a}=e,i=le(Ne,{__demoMode:n,menuState:n?0:1,buttonRef:X(),itemsRef:X(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:s,itemsRef:l,buttonRef:t},u]=i,m=N(r);me([t,l],(p,A)=>{var P;u({type:1}),Fe(A,_e.Loose)||(p.preventDefault(),(P=t.current)==null||P.focus())},s===0);let d=I(()=>{u({type:1})}),M=U(()=>({open:s===0,close:d}),[s,d]),f={ref:m};return b.createElement(Ie,null,b.createElement(J.Provider,{value:i},b.createElement(Re,{value:Z(s,{[0]:w.Open,[1]:w.Closed})},R({ourProps:f,theirProps:a,slot:M,defaultTag:we,name:"Menu"}))))}let We="button";function Ke(e,r){var D,F,h;let n=H(),{id:a=`headlessui-menu-button-${n}`,...i}=e,[s,l]=B("Menu.Button"),t=Se(),u=N(s.buttonRef,r,Ae()),m=q(),d=I(c=>{switch(c.key){case T.Space:case T.Enter:case T.ArrowDown:c.preventDefault(),c.stopPropagation(),l({type:0}),m.nextFrame(()=>l({type:2,focus:y.First}));break;case T.ArrowUp:c.preventDefault(),c.stopPropagation(),l({type:0}),m.nextFrame(()=>l({type:2,focus:y.Last}));break}}),M=I(c=>{switch(c.key){case T.Space:c.preventDefault();break}}),f=I(c=>{if(xe(c.currentTarget))return c.preventDefault();e.disabled||(s.menuState===0?(l({type:1}),m.nextFrame(()=>{var C;return(C=s.buttonRef.current)==null?void 0:C.focus({preventScroll:!0})})):(c.preventDefault(),l({type:0})))}),{isFocusVisible:p,focusProps:A}=re({autoFocus:(D=e.autoFocus)!=null?D:!1}),{isHovered:P,hoverProps:S}=oe({isDisabled:(F=e.disabled)!=null?F:!1}),{pressed:v,pressProps:x}=ue(),_=U(()=>{var c;return{open:s.menuState===0,active:v||s.menuState===0,hover:P,focus:p,autofocus:(c=e.autoFocus)!=null?c:!1}},[s,P,p,v,e.autoFocus]),O=te(t(),{ref:u,id:a,type:fe(e,s.buttonRef),"aria-haspopup":"menu","aria-controls":(h=s.itemsRef.current)==null?void 0:h.id,"aria-expanded":s.menuState===0,onKeyDown:d,onKeyUp:M,onClick:f},A,S,x);return R({ourProps:O,theirProps:i,slot:_,defaultTag:We,name:"Menu.Button"})}let je="div",Qe=ee.RenderStrategy|ee.Static;function Je(e,r){var C,g;let n=H(),{id:a=`headlessui-menu-items-${n}`,anchor:i,modal:s,...l}=e,[t,u]=B("Menu.Items"),[m,d]=Me(i),M=Pe(),f=N(t.itemsRef,r,m),p=ce(t.itemsRef);i!=null&&s==null?s=!0:s==null&&(s=!1);let A=q(),P=ve(),S=(()=>P!==null?(P&w.Open)===w.Open:t.menuState===0)(),x=pe(t.buttonRef,t.menuState!==0)?!1:S;se(()=>{let o=t.itemsRef.current;o&&t.menuState===0&&o!==(p==null?void 0:p.activeElement)&&o.focus({preventScroll:!0})},[t.menuState,t.itemsRef,p]),ge({container:t.itemsRef.current,enabled:t.menuState===0,accept(o){return o.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:o.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(o){o.setAttribute("role","none")}});let _=I(o=>{var L,V;switch(A.dispose(),o.key){case T.Space:if(t.searchQuery!=="")return o.preventDefault(),o.stopPropagation(),u({type:3,value:o.key});case T.Enter:if(o.preventDefault(),o.stopPropagation(),u({type:1}),t.activeItemIndex!==null){let{dataRef:G}=t.items[t.activeItemIndex];(V=(L=G.current)==null?void 0:L.domRef.current)==null||V.click()}Y(t.buttonRef.current);break;case T.ArrowDown:return o.preventDefault(),o.stopPropagation(),u({type:2,focus:y.Next});case T.ArrowUp:return o.preventDefault(),o.stopPropagation(),u({type:2,focus:y.Previous});case T.Home:case T.PageUp:return o.preventDefault(),o.stopPropagation(),u({type:2,focus:y.First});case T.End:case T.PageDown:return o.preventDefault(),o.stopPropagation(),u({type:2,focus:y.Last});case T.Escape:o.preventDefault(),o.stopPropagation(),u({type:1}),j().nextFrame(()=>{var G;return(G=t.buttonRef.current)==null?void 0:G.focus({preventScroll:!0})});break;case T.Tab:o.preventDefault(),o.stopPropagation(),u({type:1}),j().microTask(()=>{De(t.buttonRef.current,o.shiftKey?z.Previous:z.Next)});break;default:o.key.length===1&&(u({type:3,value:o.key}),A.setTimeout(()=>u({type:4}),350));break}}),O=I(o=>{switch(o.key){case T.Space:o.preventDefault();break}}),D=U(()=>({open:t.menuState===0}),[t]),F=te(M(),{"aria-activedescendant":t.activeItemIndex===null||(C=t.items[t.activeItemIndex])==null?void 0:C.id,"aria-labelledby":(g=t.buttonRef.current)==null?void 0:g.id,id:a,onKeyDown:_,onKeyUp:O,role:"menu",tabIndex:0,ref:f,style:{...d,"--button-width":de(t.buttonRef,!0).width}}),h=s?be:i?Le:W,c=s?{features:Ee.ScrollLock,enabled:t.menuState===0}:{};return b.createElement(h,{...c},R({ourProps:F,theirProps:l,slot:D,defaultTag:je,features:Qe,visible:x,name:"Menu.Items"}))}let Ve=W;function Xe(e,r){let n=H(),{id:a=`headlessui-menu-item-${n}`,disabled:i=!1,...s}=e,[l,t]=B("Menu.Item"),u=l.activeItemIndex!==null?l.items[l.activeItemIndex].id===a:!1,m=$(null),d=N(r,m);k(()=>{if(l.__demoMode||l.menuState!==0||!u||l.activationTrigger===0)return;let g=j();return g.requestAnimationFrame(()=>{var o,L;(L=(o=m.current)==null?void 0:o.scrollIntoView)==null||L.call(o,{block:"nearest"})}),g.dispose},[l.__demoMode,m,u,l.menuState,l.activationTrigger,l.activeItemIndex]);let M=Te(m),f=$({disabled:i,domRef:m,get textValue(){return M()}});k(()=>{f.current.disabled=i},[f,i]),k(()=>(t({type:5,id:a,dataRef:f}),()=>t({type:6,id:a})),[f,a]);let p=I(()=>{t({type:1})}),A=I(g=>{if(i)return g.preventDefault();t({type:1}),Y(l.buttonRef.current)}),P=I(()=>{if(i)return t({type:2,focus:y.Nothing});t({type:2,focus:y.Specific,id:a})}),S=ye(),v=I(g=>{S.update(g),!i&&(u||t({type:2,focus:y.Specific,id:a,trigger:0}))}),x=I(g=>{S.wasMoved(g)&&(i||u||t({type:2,focus:y.Specific,id:a,trigger:0}))}),_=I(g=>{S.wasMoved(g)&&(i||u&&t({type:2,focus:y.Nothing}))}),[O,D]=ne(),[F,h]=Ce(),c=U(()=>({active:u,focus:u,disabled:i,close:p}),[u,i,p]);return b.createElement(D,null,b.createElement(h,null,R({ourProps:{id:a,ref:d,role:"menuitem",tabIndex:i===!0?void 0:-1,"aria-disabled":i===!0?!0:void 0,"aria-labelledby":O,"aria-describedby":F,disabled:void 0,onClick:A,onFocus:P,onPointerEnter:v,onMouseEnter:v,onPointerMove:x,onMouseMove:x,onPointerLeave:_,onMouseLeave:_},theirProps:s,slot:c,defaultTag:Ve,name:"Menu.Item"})))}let $e="div";function qe(e,r){let[n,a]=ne();return b.createElement(a,null,R({ourProps:{ref:r,"aria-labelledby":n,role:"group"},theirProps:e,slot:{},defaultTag:$e,name:"Menu.Section"}))}let ze="header";function Ye(e,r){let n=H(),{id:a=`headlessui-menu-heading-${n}`,...i}=e,s=Oe();k(()=>s.register(a),[a,s.register]);let l={id:a,ref:r,role:"presentation",...s.props};return R({ourProps:l,theirProps:i,slot:{},defaultTag:ze,name:"Menu.Heading"})}let Ze="div";function et(e,r){return R({ourProps:{ref:r,role:"separator"},theirProps:e,slot:{},defaultTag:Ze,name:"Menu.Separator"})}let tt=E(Be),nt=E(Ke),rt=E(Je),ot=E(Xe),at=E(qe),it=E(Ye),st=E(et),kt=Object.assign(tt,{Button:nt,Items:rt,Item:ot,Section:at,Heading:it,Separator:st});export{kt as Menu,nt as MenuButton,it as MenuHeading,ot as MenuItem,rt as MenuItems,at as MenuSection,st as MenuSeparator};
